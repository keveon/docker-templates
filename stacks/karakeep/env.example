# ================================
# 基础配置
# ================================

# Karakeep 版本（release 为最新稳定版，或指定如 0.29.1）
KARAKEEP_VERSION=release

# 时区
TZ=Asia/Shanghai

# 日志级别（error, warn, info, http, verbose, debug, silly）
LOG_LEVEL=info

# 最大上传文件大小（MB）
MAX_ASSET_SIZE_MB=50

# 禁用新版本检查
# DISABLE_NEW_RELEASE_CHECK=false

# 启用 API 限流
# RATE_LIMITING_ENABLED=false

# 启用 SQLite WAL 模式（提升并发性能）
# DB_WAL_MODE=false

# ================================
# 认证配置（必填）
# ================================

# NextAuth 密钥，用于 JWT 签名（使用 openssl rand -base64 36 生成）
NEXTAUTH_SECRET=your_random_secret_here

# 服务访问地址（必须与实际访问地址一致）
NEXTAUTH_URL=https://karakeep.example.com

# 禁止新用户注册（首个用户注册后建议设为 true）
DISABLE_SIGNUPS=false

# 禁用密码认证（启用 OAuth 后建议设为 true）
# DISABLE_PASSWORD_AUTH=false

# 要求邮箱验证（需配置 SMTP）
# EMAIL_VERIFICATION_REQUIRED=false

# ================================
# OAuth 认证（可选）
# ================================

# OAuth 提供商名称（显示在登录按钮上）
# OAUTH_PROVIDER_NAME=Authentik

# OAuth OIDC 发现端点
# OAUTH_WELLKNOWN_URL=https://auth.example.com/application/o/karakeep/.well-known/openid-configuration

# OAuth 客户端凭据
# OAUTH_CLIENT_ID=your_client_id
# OAUTH_CLIENT_SECRET=your_client_secret

# OAuth 请求的权限范围
# OAUTH_SCOPE=openid email profile

# OAuth 响应超时时间（毫秒）
# OAUTH_TIMEOUT=3500

# 允许邮箱账户关联（OAuth 用户与已有同邮箱账户自动关联）
# OAUTH_ALLOW_DANGEROUS_EMAIL_ACCOUNT_LINKING=false

# ================================
# 搜索配置（必填）
# ================================

# Meilisearch 主密钥（使用 openssl rand -base64 36 生成）
MEILI_MASTER_KEY=your_meili_key_here

# Meilisearch 版本
MEILI_VERSION=v1.13.3

# 搜索索引并发任务数
SEARCH_NUM_WORKERS=1

# 搜索任务超时时间（秒）
SEARCH_JOB_TIMEOUT_SEC=30

# ================================
# 爬虫配置
# ================================

# 爬虫并发任务数
CRAWLER_NUM_WORKERS=1

# 按需连接浏览器（而非持久连接）
# BROWSER_CONNECT_ONDEMAND=false

# 下载并缓存 banner 图片
CRAWLER_DOWNLOAD_BANNER_IMAGE=true

# 保存网页截图
CRAWLER_STORE_SCREENSHOT=true

# 全页截图（而非仅可视区域）
# CRAWLER_FULL_PAGE_SCREENSHOT=false

# 截图超时时间（秒）
CRAWLER_SCREENSHOT_TIMEOUT_SEC=5

# 保存网页完整本地副本
# CRAWLER_FULL_PAGE_ARCHIVE=false

# 爬虫任务超时时间（秒）
CRAWLER_JOB_TIMEOUT_SEC=60

# 页面导航超时时间（秒）
CRAWLER_NAVIGATE_TIMEOUT_SEC=30

# 启用广告拦截
CRAWLER_ENABLE_ADBLOCKER=true

# ================================
# 视频下载配置
# ================================

# 启用视频下载（使用 yt-dlp）
CRAWLER_VIDEO_DOWNLOAD=false

# 视频最大文件大小（MB）
CRAWLER_VIDEO_DOWNLOAD_MAX_SIZE=50

# 视频下载超时时间（秒）
CRAWLER_VIDEO_DOWNLOAD_TIMEOUT_SEC=600

# ================================
# AI 配置（可选）
# ================================

# 方式一：使用 OpenAI（支持兼容 API）
# OPENAI_API_KEY=sk-xxx
# OPENAI_BASE_URL=https://api.openai.com/v1  # 可选，自定义 API 端点

# 方式二：使用 Ollama（本地模型）
# OLLAMA_BASE_URL=http://ollama:11434
# OLLAMA_KEEP_ALIVE=5m  # 模型保持加载时间

# 文本推理模型（OpenAI: gpt-4o-mini / Ollama: llama3.1）
INFERENCE_TEXT_MODEL=gpt-4o-mini

# 图像推理模型（OpenAI: gpt-4o-mini / Ollama: llava）
INFERENCE_IMAGE_MODEL=gpt-4o-mini

# 文本嵌入模型（用于语义搜索，OpenAI: text-embedding-3-small）
EMBEDDING_TEXT_MODEL=text-embedding-3-small

# 推理语言（如 chinese、english）
INFERENCE_LANG=chinese

# 推理上下文长度（影响成本和质量）
INFERENCE_CONTEXT_LENGTH=2048

# 最大输出 token 数
INFERENCE_MAX_OUTPUT_TOKENS=2048

# 使用新版 OpenAI max_completion_tokens 参数（适用于 GPT-5/o-series）
# INFERENCE_USE_MAX_COMPLETION_TOKENS=false

# 并发推理任务数
INFERENCE_NUM_WORKERS=1

# 启用自动标签
INFERENCE_ENABLE_AUTO_TAGGING=true

# 启用自动摘要
INFERENCE_ENABLE_AUTO_SUMMARIZATION=true

# 推理任务超时时间（秒）
INFERENCE_JOB_TIMEOUT_SEC=30

# Ollama 请求超时时间（秒）
INFERENCE_FETCH_TIMEOUT_SEC=300

# 输出格式（structured / json / plain）
INFERENCE_OUTPUT_SCHEMA=structured

# ================================
# OCR 配置
# ================================

# OCR 语言（逗号分隔，如 eng,chi_sim,chi_tra）
OCR_LANGS=eng,chi_sim,chi_tra

# OCR 置信度阈值（0-100，低于此值的结果将被忽略）
OCR_CONFIDENCE_THRESHOLD=50

# ================================
# Webhook 配置
# ================================

# Webhook 并发任务数
WEBHOOK_NUM_WORKERS=1

# Webhook 请求超时时间（秒）
WEBHOOK_TIMEOUT_SEC=5

# Webhook 重试次数
WEBHOOK_RETRY_TIMES=3

# ================================
# SMTP 邮件配置（可选）
# ================================

# SMTP 服务器地址
# SMTP_HOST=smtp.example.com

# SMTP 端口
# SMTP_PORT=587

# 使用 SSL/TLS 加密
# SMTP_SECURE=false

# SMTP 用户名
# SMTP_USER=your_username

# SMTP 密码
# SMTP_PASSWORD=your_password

# 发件人地址
# SMTP_FROM=noreply@example.com

# ================================
# S3 存储配置（可选）
# ================================

# S3 端点（MinIO 等兼容服务必填）
# ASSET_STORE_S3_ENDPOINT=https://s3.example.com

# S3 区域
# ASSET_STORE_S3_REGION=us-east-1

# S3 存储桶名称
# ASSET_STORE_S3_BUCKET=karakeep

# S3 访问密钥
# ASSET_STORE_S3_ACCESS_KEY_ID=your_access_key
# ASSET_STORE_S3_SECRET_ACCESS_KEY=your_secret_key

# 强制使用路径风格 URL（MinIO 等需要）
# ASSET_STORE_S3_FORCE_PATH_STYLE=false

# ================================
# 代理配置（可选）
# ================================

# HTTP 代理
# CRAWLER_HTTP_PROXY=http://proxy.example.com:8080

# HTTPS 代理
# CRAWLER_HTTPS_PROXY=http://proxy.example.com:8080

# 不使用代理的地址（逗号分隔）
# CRAWLER_NO_PROXY=localhost,127.0.0.1
